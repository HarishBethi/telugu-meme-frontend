<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Telugu Meme Generator — Light Blur Portrait (1080×1350)</title>
<style>
  :root{
    --bg:#0b0f19;
    --card:#121a2c;
    --accent:#ff675c;
    --muted:#9aa7b2;
  }
  html,body{height:100%;margin:0;font-family:Inter, Arial, Helvetica, sans-serif;background:var(--bg);color:#fff}
  header{padding:18px;text-align:center;background:#0f1720;font-weight:700;font-size:20px}
  .wrap{display:flex;gap:18px;padding:18px;max-width:1200px;margin:16px auto}
  .left{width:300px;max-height:82vh;overflow:auto;background:var(--card);border-radius:10px;padding:12px;box-sizing:border-box}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  .thumb{background:#0c1420;border-radius:8px;padding:6px;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.03)}
  .thumb img{width:140px;height:140px;object-fit:cover;border-radius:6px}
  .tname{font-size:12px;color:var(--muted);text-align:center;margin-top:8px;word-break:break-word}
  .center{flex:1;display:flex;flex-direction:column;align-items:center;gap:12px}
  .canvas-wrap{background:var(--card);padding:18px;border-radius:10px;display:flex;flex-direction:column;align-items:center;gap:12px}
  canvas{background:#000;border-radius:8px;max-width:100%;height:auto;box-shadow:0 6px 18px rgba(0,0,0,0.6)}
  .inputs{display:flex;gap:8px;width:100%;justify-content:center;flex-wrap:wrap}
  input[type="text"]{padding:10px;border-radius:8px;border:none;width:48%;min-width:180px;font-size:16px}
  .controls{display:flex;gap:8px;align-items:center}
  button{padding:10px 14px;border-radius:8px;border:none;background:var(--accent);color:#000;font-weight:700;cursor:pointer}
  .muted{color:var(--muted);font-size:13px;margin-top:6px}
  .small-note{font-size:12px;color:var(--muted)}
  @media(max-width:980px){.wrap{flex-direction:column;padding:12px}.left{width:100%;max-height:220px}.grid{grid-template-columns:repeat(4,1fr)} .thumb img{width:80px;height:80px}}
</style>
</head>
<body>
<header>Telugu Meme Generator — Portrait 1080×1350 (Blur background)</header>

<div class="wrap">
  <aside class="left">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:600">Templates</div>
      <div class="small-note">Click to load</div>
    </div>

    <div class="grid" id="thumbGrid">
      <!-- thumbnails inserted by JS -->
    </div>

    <div class="muted" style="margin-top:10px">
      Tip: Grid shows thumbnails; click one to load. Use Top/Bottom text inputs and press Download.
    </div>
  </aside>

  <main class="center">
    <div class="canvas-wrap">
      <canvas id="memeCanvas" width="1080" height="1350"></canvas>

      <div class="inputs">
        <input id="topText" type="text" placeholder="Top text (max 2 lines)" maxlength="140" />
        <input id="bottomText" type="text" placeholder="Bottom text (max 2 lines)" maxlength="140" />
      </div>

      <div class="controls">
        <button id="downloadBtn">Download PNG</button>
        <div style="width:12px"></div>
        <label class="small-note" style="display:flex;align-items:center;gap:8px">
          <input id="showGrid" type="checkbox" checked /> Show grid
        </label>
      </div>
    </div>
  </main>
</div>

<script>
/* ---------------------
  CONFIG: your image URLs
  --------------------- */
const IMAGES = [
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117753/arehoo2_fhbxj4.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117753/arehoo1_w5azaj.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117784/samba_villian_khnvrm.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117795/venky_brahmi_shock3_wwk50t.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117795/venky_brahmi_shock2_wurmbe.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117795/venky_brahmi_shock_jokgax.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117785/Talent_chupisthunav_enty_bl2esm.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117785/Tamanna_KIKK_sqrekc.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117784/sontham_msn_qsx6jy.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117785/veedu_musalodu_avvakudadhe_ugirbi.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117784/Sunil_andarivadu_uecet4.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117785/venky_brahmi_innocent_zpnmjr.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117784/ready_brahmi_jarpnj.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117784/Rajni_crying_wmwqyy.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117784/Pruthvi_Atharinitiki_Daredi_d2dhqd.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117775/mari_antha_yadava_sevzul.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117775/neninthe_venumadhav_inrbmm.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117774/Manmadhudu_brahmi2_ndqr2t.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117774/Natinchaku_igj0zg.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117774/mr_bean_mdaeqi.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117774/Manmadhudu_brahmi1_j5lnqe.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117774/krishna_brahmi_cqsyok.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117773/king_brahmi_6_qybabd.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117773/king_brahmi_7_vflsqw.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117762/king_brahmi_5_rxqkbq.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117755/king_brahmi_1_s1c6vv.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117755/king_brahmi_4_ksoand.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117755/king_brahmi_3_k1pqs6.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117754/dubai_sreenu_krishna_baghavan_pyuxzq.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117754/dubai_sreenu_avs_ozjazs.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117754/brahmi_lakshmi_movie_fypuo1.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117755/king_brahmi_2_fz6bwi.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117754/brahmi_khaleja_agip6g.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117754/Gamyam_gvq44i.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117754/Emaindi_ra_dtbv9f.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117754/brahmi_dhee_eywc8c.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117753/brahmi_badhshah_u0djlc.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117753/Brahmi_Attharitiniki_daredi_w4ptlr.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117753/bal_lav_de_ka_bal_c2rco3.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117753/apartichitudu_prakashraj_j7hzs4.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117753/Ali_Super_movie_qsa758.jpg",
"https://res.cloudinary.com/dui1jtybs/image/upload/v1763117753/Addi_movie_villian_bqqnaj.jpg"
];

/* ---------------------
  helpers & DOM refs
  --------------------- */
const thumbGrid = document.getElementById('thumbGrid');
const canvas = document.getElementById('memeCanvas');
const ctx = canvas.getContext('2d');
const topTextInput = document.getElementById('topText');
const bottomTextInput = document.getElementById('bottomText');
const downloadBtn = document.getElementById('downloadBtn');
const showGridCheck = document.getElementById('showGrid');

let activeUrl = null;
let bgImg = null;
let mainImg = null;

/* create thumbnail grid */
function shortNameFromUrl(url){
  try{
    const fn = url.split('/').pop().split('.')[0];
    // remove trailing random id (6+ chars) e.g. _khnvrm
    const short = fn.replace(/_[a-z0-9]{5,}$/i, '');
    return short.charAt(0).toUpperCase() + short.slice(1);
  }catch(e){ return url; }
}

function buildGrid(){
  thumbGrid.innerHTML = '';
  IMAGES.forEach(url=>{
    const div = document.createElement('div');
    div.className = 'thumb';
    div.title = shortNameFromUrl(url);
    div.innerHTML = `<img src="${url}" loading="lazy" alt="${shortNameFromUrl(url)}" crossorigin="anonymous"/><div class="tname">${shortNameFromUrl(url)}</div>`;
    div.addEventListener('click', ()=>{ loadTemplate(url); if (!showGridCheck.checked) thumbGrid.parentElement.style.display='none'; });
    thumbGrid.appendChild(div);
  });
}

/* ---------------------
  load template image (background + main)
  --------------------- */
function loadTemplate(url){
  activeUrl = url;
  // background image (we will blur scaled to cover)
  bgImg = new Image();
  mainImg = new Image();
  bgImg.crossOrigin = 'anonymous';
  mainImg.crossOrigin = 'anonymous';

  // use same url for both; background will be drawn full-canvas & blurred, main will be centered
  bgImg.src = url;
  mainImg.src = url;

  // when both loaded -> draw
  let loaded=0;
  function onLoad(){
    loaded++;
    if(loaded>=2) drawMeme();
  }
  bgImg.onload = onLoad;
  mainImg.onload = onLoad;
  bgImg.onerror = ()=>{ alert('Failed to load image'); };
}

/* ---------------------
  Utility: wrap into lines given font and maxWidth
  --------------------- */
function wrapIntoLines(ctx, text, maxWidth) {
  if (!text) return [];
  const words = text.split(' ');
  const lines = [];
  let line = '';
  for (let i=0;i<words.length;i++){
    const test = line ? (line + ' ' + words[i]) : words[i];
    const w = ctx.measureText(test).width;
    if (w > maxWidth && line) {
      lines.push(line.trim());
      line = words[i];
    } else {
      line = test;
    }
  }
  if (line) lines.push(line.trim());
  return lines;
}

/* ---------------------
  Auto-fit font size so wrapped lines <= 2
  --------------------- */
function chooseFontSizeForText(ctx, text, maxWidth, maxLines, baseSizes = [60,48,40,36,32,28,24,20]) {
  for (let s of baseSizes) {
    ctx.font = `${s}px Impact, Arial Black, sans-serif`;
    const lines = wrapIntoLines(ctx, text, maxWidth);
    if (lines.length <= maxLines) return s;
    // if still > maxLines reduce by trying next size
  }
  return baseSizes[baseSizes.length-1];
}

/* ---------------------
  Draw Meme: blurred background + centered main image + top/bottom text
  --------------------- */
function drawMeme(){
  // clear
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // background blank if no image
  if (!bgImg || !mainImg) {
    ctx.fillStyle='#000';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    return;
  }

  // --------- draw blurred background (subtle) ----------
  // draw background as cover into offscreen, then blur via ctx.filter
  // we will draw bg image scaled to cover and then apply light blur
  ctx.save();
  // draw scaled-to-cover background
  const cw = canvas.width, ch = canvas.height;
  const iw = bgImg.width, ih = bgImg.height;
  // scale to cover
  const scale = Math.max(cw/iw, ch/ih);
  const bw = iw*scale, bh = ih*scale;
  const bx = (cw - bw)/2, by = (ch - bh)/2;

  ctx.filter = 'blur(8px) saturate(110%) brightness(95%)';
  ctx.drawImage(bgImg, bx, by, bw, bh);
  ctx.filter = 'none';
  ctx.restore();

  // --------- draw centered main image (fit inside area with padding) ----------
  const padding = 80; // leave space for text top/bottom
  const maxW = cw - padding*2;
  const maxH = ch - padding*2;
  let mw = mainImg.width, mh = mainImg.height;
  const mscale = Math.min(maxW/mw, maxH/mh, 1);
  mw = mw*mscale; mh = mh*mscale;
  const mx = (cw - mw)/2, my = (ch - mh)/2;
  // draw a subtle rounded rect background behind main image (optional)
  // draw main image
  ctx.drawImage(mainImg, mx, my, mw, mh);

  // --------- prepare text drawing ----------
  ctx.textAlign = 'center';
  ctx.lineJoin = 'round';
  ctx.strokeStyle = '#000';
  ctx.fillStyle = '#fff';

  // compute top text font
  const maxTextWidth = cw - 120; // leave margins
  let topText = topTextInput.value.trim();
  let bottomText = bottomTextInput.value.trim();

  // choose font size that makes wrapped lines <= 2
  const topSize = chooseFontSizeForText(ctx, topText, maxTextWidth, 2, [72,60,48,44,40,36,32,28,24]);
  const bottomSize = chooseFontSizeForText(ctx, bottomText, maxTextWidth, 2, [72,60,48,44,40,36,32,28,24]);

  // draw top text lines
  ctx.font = `${topSize}px Impact, Arial Black, sans-serif`;
  ctx.lineWidth = Math.max(4, Math.round(topSize / 12));
  const topLines = wrapIntoLines(ctx, topText, maxTextWidth);
  // clamp to 2 lines max
  const topLinesClamped = topLines.slice(0,2);
  topLinesClamped.forEach((l,i)=>{
    const y = 60 + i * (topSize + 6);
    ctx.strokeText(l.toUpperCase(), cw/2, y);
    ctx.fillText(l.toUpperCase(), cw/2, y);
  });

  // draw bottom text lines (from bottom up)
  ctx.font = `${bottomSize}px Impact, Arial Black, sans-serif`;
  ctx.lineWidth = Math.max(4, Math.round(bottomSize / 12));
  const bottomLines = wrapIntoLines(ctx, bottomText, maxTextWidth);
  const bottomLinesClamped = bottomLines.slice(-2); // keep last two lines
  // draw so that last line is near bottom with small padding
  for (let i=0;i<bottomLinesClamped.length;i++){
    const idx = bottomLinesClamped.length - 1 - i;
    const l = bottomLinesClamped[idx];
    const y = ch - 40 - i * (bottomSize + 6);
    ctx.strokeText(l.toUpperCase(), cw/2, y);
    ctx.fillText(l.toUpperCase(), cw/2, y);
  }
}

/* ---------------------
  wire events
  --------------------- */
topTextInput.addEventListener('input', ()=>{ drawMeme(); });
bottomTextInput.addEventListener('input', ()=>{ drawMeme(); });
downloadBtn.addEventListener('click', ()=>{
  // ensure something loaded
  if (!mainImg) { alert('Please select a template first'); return; }
  const link = document.createElement('a');
  link.download = 'meme.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
});
showGridCheck.addEventListener('change', ()=>{
  document.querySelector('.left').style.display = showGridCheck.checked ? 'block' : 'none';
});

/* ---------------------
  init
  --------------------- */
buildGrid();
// auto-load first image
if (IMAGES.length) loadTemplate(IMAGES[0]);

// redraw on window resize keeping aspect ratio consistent (canvas has fixed size but we can redraw)
window.addEventListener('resize', ()=>{
  // For responsiveness the canvas element width is scaled by CSS; keep internal resolution fixed
  drawMeme();
});
</script>
</body>
</html>
